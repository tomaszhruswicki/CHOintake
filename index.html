<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kalkulator żywienia i nawodnienia</title>
  <meta name="theme-color" content="#0ea5e9" />
  <style>
    :root{
      --bg:#f8fafc;--fg:#0f172a;--muted:#64748b;--card:#ffffff;--ring:#e2e8f0;
      --emerald:#059669;--sky:#0369a1;--amber:#92400e;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(#fff,#f8fafc);color:var(--fg);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    .container{max-width:960px;margin:0 auto;padding:16px}
    h1{font-size:28px;margin:0 0 4px}
    .muted{color:var(--muted);font-size:13px}
    .grid{display:grid;gap:16px}
    .card{background:var(--card);border:1px solid var(--ring);border-radius:16px;box-shadow:0 1px 2px rgba(0,0,0,.03)}
    .card-h{padding:14px 16px;border-bottom:1px solid var(--ring)}
    .card-c{padding:16px}
    .btn{appearance:none;border:1px solid var(--ring);background:#fff;padding:8px 12px;border-radius:999px;cursor:pointer}
    .btn:focus{outline:2px solid #93c5fd;outline-offset:2px}
    .btn.primary{background:#0f172a;color:#fff;border-color:#0f172a}
    .btn.ghost{background:#fff}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .input{border:1px solid var(--ring);border-radius:10px;padding:8px 10px;width:96px}
    .kpis{display:grid;gap:16px}
    @media (min-width:900px){.kpis{grid-template-columns:repeat(3,1fr)}}
    .title{display:flex;align-items:center;gap:8px;font-weight:600}
    .pill{display:inline-block;background:#ecfeff;color:#0369a1;border:1px solid #bae6fd;border-radius:999px;padding:2px 8px;font-size:12px}
    .copy{display:flex;justify-content:flex-end}
    .big{font-size:28px;font-weight:700}
    .tips{background:#f0fdf4;border:1px solid #bbf7d0;border-radius:12px;padding:10px}
    .tips.sky{background:#f0f9ff;border-color:#bae6fd}
    .tips.amber{background:#fffbeb;border-color:#fde68a}
    .list{margin:6px 0 0 16px;padding:0}
    .list li{margin:4px 0}
    .slider-wrap{padding:0 4px}
    input[type=range]{width:100%}
  </style>
</head>
<body>
  <div class="container grid">
    <header class="grid" style="gap:8px">
      <div>
        <h1>Kalkulator żywienia i nawodnienia</h1>
        <p class="muted">Rekomendacje jako zakres ±10 g/h. Dla średnich: RPE≤4 → 60, RPE5 → 70, RPE6 → 80, RPE≥7 → 90–110 g/h.</p>
      </div>
      <div class="copy"><button id="copyBtn" class="btn">Kopiuj plan / h</button></div>
    </header>

    <section class="card">
      <div class="card-h"><strong>Ustaw parametry</strong></div>
      <div class="card-c grid" style="gap:20px">
        <div class="grid" style="gap:8px">
          <label class="muted">Długość treningu</label>
          <div class="row" id="lenRow"></div>
        </div>
        <div class="grid" style="gap:8px">
          <label class="muted">Intensywność (RPE 1–10)</label>
          <div class="slider-wrap"><input id="rpe" type="range" min="1" max="10" step="1" value="6"></div>
          <div class="row" style="justify-content:space-between"><span class="muted">1</span><span id="rpeLbl" class="muted">6 • umiarkowanie</span><span class="muted">10</span></div>
        </div>
        <div class="grid" style="gap:8px">
          <label class="muted">Temperatura (°C)</label>
          <div class="row">
            <input id="temp" class="input" type="number" inputmode="numeric" value="18">
            <div class="row">
              <button class="btn" data-tpreset="10">10°</button>
              <button class="btn" data-tpreset="20">20°</button>
              <button class="btn" data-tpreset="25">25°</button>
              <button class="btn" data-tpreset="30">30°</button>
              <button class="btn" data-tpreset="35">35°</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="kpis">
      <div class="card">
        <div class="card-h title" style="color:var(--emerald)">Węglowodany <span id="headline" class="pill"></span></div>
        <div class="card-c grid" style="gap:10px">
          <div class="big" id="choRec">— g/h</div>
          <div class="muted" id="choRange">Zakres: — g/h</div>
          <div class="tips">
            <p class="" style="margin:0 0 6px 0"><strong>Przykład na godzinę</strong></p>
            <ul class="list" id="exampleList"></ul>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-h title" style="color:var(--sky)">Nawodnienie</div>
        <div class="card-c grid" style="gap:10px">
          <div class="big" id="fluid">— L/h</div>
          <div class="muted">Oszacowanie wg temp. i RPE. Izotonik 6–8% (60–80 g CHO/L).</div>
          <div class="tips sky">
            <p style="margin:0 0 6px 0"><strong>Wskazówki</strong></p>
            <ul class="list">
              <li>Pij małymi łykami co 10–15 min.</li>
              <li>W upał zwiększ częstotliwość i rozcieńczaj napój.</li>
              <li>Strata masy &gt;2% = za mało płynu.</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-h title" style="color:var(--amber)">Przed treningiem</div>
        <div class="card-c grid" style="gap:10px">
          <div class="big" id="preMeal">— g</div>
          <div class="muted">Orientacyjnie 1–2× docelowej dawki/h w posiłku 2–3 h przed.</div>
          <div class="tips amber">
            <p style="margin:0">Przy krótkich i lekkich sesjach często wystarczy sam posiłek przed i woda.</p>
          </div>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="card-c muted">Uwaga: zalecenia ogólne. Testuj strategię na treningu. Dla długich i bardzo ciężkich jednostek rozważ 90–110 g/h (glukoza+fruktoza ≈2:1). W problemach żołądkowych zmniejsz tempo podaży i zwiększ udział płynów.</div>
    </section>
  </div>

  <script>
    const lenRow = document.getElementById('lenRow');
    const rpeEl = document.getElementById('rpe');
    const rpeLbl = document.getElementById('rpeLbl');
    const tempEl = document.getElementById('temp');
    const copyBtn = document.getElementById('copyBtn');

    const choRecEl = document.getElementById('choRec');
    const choRangeEl = document.getElementById('choRange');
    const headlineEl = document.getElementById('headline');
    const fluidEl = document.getElementById('fluid');
    const preMealEl = document.getElementById('preMeal');
    const exampleList = document.getElementById('exampleList');

    const lengthOptions = [
      { key: 'short', label: "krótki <60'" },
      { key: 'medium', label: "średni 60–120'" },
      { key: 'long', label: "długi >120'" },
    ];

    let lengthKey = 'medium';

    function round5(x){ return Math.round(x/5)*5 }
    function clamp(x,a,b){ return Math.min(Math.max(x,a),b) }

    function rpeText(rpe){
      if(rpe<=3) return 'lekko';
      if(rpe<=6) return 'umiarkowanie';
      if(rpe<=8) return 'ciężko';
      return 'bardzo ciężko';
    }

    function choRange(lengthKey, rpe){
      let rec=0, min=0, max=0;
      if(lengthKey==='short'){
        if(rpe<=4){ rec=0; min=0; max=0; }
        else if(rpe<=6){ rec=40; min=30; max=50; }
        else { rec=60; min=50; max=70; }
      }
      if(lengthKey==='medium'){
        if(rpe<=4){ rec=60; min=50; max=70; }
        else if(rpe===5){ rec=70; min=60; max=80; }
        else if(rpe===6){ rec=80; min=70; max=90; }
        else { rec=100; min=90; max=110; }
      }
      if(lengthKey==='long'){
        if(rpe<=4){ rec=70; min=60; max=80; }
        else if(rpe<=6){ rec=80; min=70; max=90; }
        else if(rpe===7){ rec=90; min=80; max=100; }
        else { rec=100; min=90; max=110; }
      }
      return {rec,min,max};
    }

    function fluidsPerHour(tempC, rpe){
      let base=0.5;
      if(tempC<=10) base=0.35; else if(tempC<=20) base=0.5; else if(tempC<=25) base=0.7; else if(tempC<=30) base=0.9; else base=1.1;
      let factor=1.0; if(rpe<=3) factor=0.85; else if(rpe<=6) factor=1.0; else if(rpe<=8) factor=1.15; else factor=1.3;
      const Lh = clamp(base*factor,0.3,1.2);
      return Math.round(Lh*10)/10;
    }

    function hourlyPlan(choTarget, fluidL){
      const isoCho = Math.round(fluidL*60); // 6% iso
      const remainder = Math.max(0, choTarget-isoCho);
      const gelG=30, chewG=20;
      let gels=0, chews=0; let rem=remainder;
      if(rem>0){ gels=Math.floor(rem/gelG); rem-=gels*gelG; if(rem>0){ chews=Math.ceil(rem/chewG);} }
      return { isoCho, gels, chews, fluidMl: Math.round((fluidL*1000)/100)*100 };
    }

    function renderLenButtons(){
      lenRow.innerHTML='';
      lengthOptions.forEach(opt=>{
        const b=document.createElement('button');
        b.className='btn'+(lengthKey===opt.key?' primary':'');
        b.textContent=opt.label;
        b.onclick=()=>{ lengthKey=opt.key; update(); renderLenButtons(); };
        lenRow.appendChild(b);
      })
    }

    function update(){
      const rpe = parseInt(rpeEl.value,10);
      rpeLbl.textContent = `${rpe} • ${rpeText(rpe)}`;
      const temp = parseFloat(tempEl.value||'0');

      const {rec,min,max} = choRange(lengthKey, rpe);
      const fluid = fluidsPerHour(temp, rpe);
      const plan = hourlyPlan(rec, fluid);

      choRecEl.textContent = `${rec} g/h`;
      choRangeEl.textContent = `Zakres: ${min}–${max} g/h`;
      headlineEl.textContent = (min>=90? '90–110 g/h' : `${min}–${max} g/h`);
      fluidEl.textContent = `${fluid} L/h`;
      preMealEl.textContent = `${round5(clamp(rec*1.5,30,180))} g`;

      exampleList.innerHTML = '';
      const li1=document.createElement('li'); li1.textContent = `${plan.fluidMl} ml izotoniku 6–8% (~${plan.isoCho} g CHO)`; exampleList.appendChild(li1);
      if(plan.gels>0){ const li=document.createElement('li'); li.textContent=`${plan.gels}× żel ~30 g`; exampleList.appendChild(li); }
      if(plan.chews>0){ const li=document.createElement('li'); li.textContent=`${plan.chews}× chews/żelki ~20 g`; exampleList.appendChild(li); }
      if(plan.gels===0 && plan.chews===0){ const li=document.createElement('li'); li.textContent=`Jeśli brak izotoniku: dobierz żele/baton do ${rec} g/h`; exampleList.appendChild(li); }

      copyBtn.onclick = () => {
        const lenLabel = lengthOptions.find(o=>o.key===lengthKey).label;
        const txt = `Długość: ${lenLabel}\nRPE: ${rpe} (${rpeText(rpe)})\nTemperatura: ${temp}°C\n\nWęgle: ${rec} g/h (zakres ${min}-${max})\nNawodnienie: ${fluid} L/h\n\nNa godzinę: ${plan.fluidMl} ml izotoniku 6–8% (~${plan.isoCho} g CHO)${plan.gels?` + ${plan.gels}× żel (30 g)`:''}${plan.chews?` + ${plan.chews}× chews (20 g)`:''}\n\nPrzed treningiem: ${round5(clamp(rec*1.5,30,180))} g w posiłku 2–3 h wcześniej.`;
        navigator.clipboard?.writeText(txt);
      };
    }

    document.querySelectorAll('[data-tpreset]').forEach(b=>{
      b.addEventListener('click',()=>{ tempEl.value = b.getAttribute('data-tpreset'); update(); })
    })
    rpeEl.addEventListener('input', update);
    tempEl.addEventListener('input', update);

    renderLenButtons();
    update();
  </script>
</body>
</html>
